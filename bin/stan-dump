#!/usr/bin/env ruby

require 'stan/client'

channel = ARGV[0]

abort "Usage: stan-dump <channel>" if ARGV.count != 1

opts = { servers: %w(nats://127.0.0.1:4222) }

sc = STAN::Client.new
sc.connect("test-cluster", "stan-dump", nats: opts)
sub = sc.subscribe(channel, deliver_all_available: true) do |msg|
  puts "CHANNEL: #{channel} | MESSAGE: (seq=#{msg.seq}) #{msg.data}"
end

sleep 0.5

sub.unsubscribe
sc.close
